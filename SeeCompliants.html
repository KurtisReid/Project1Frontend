<!DOCTYPE html>
<html lang="en">
<head>
<title>W3.CSS Template</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
body,h1,h2,h3,h4,h5,h6 {font-family: "Lato", sans-serif}
.w3-bar,h1,button {font-family: "Montserrat", sans-serif}
.fa-anchor,.fa-coffee {font-size:200px}
.bgimg {
  background-repeat: no-repeat;
  background-size: cover;
  background-image: url("https://static.wikia.nocookie.net/starwars/images/e/e6/MosEisley-celebration.png/revision/latest?cb=20130420052326");
  min-height: 90%;
}
</style>
</head>
<body>

<!-- Navbar -->
<div class="w3-top">
    <div class="w3-bar w3-red w3-card w3-left-align w3-large">
        <a class="w3-bar-item w3-button w3-hide-medium w3-hide-large w3-right w3-padding-large w3-hover-white w3-large w3-red" href="javascript:void(0);" onclick="myFunction()" title="Toggle Navigation Menu"><i class="fa fa-bars"></i></a>
        <a href="#" class="w3-bar-item w3-button w3-padding-large w3-white">Home</a>
        <a href="#" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-white">See Compliants</a>
        <a href="#" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-white">See Meetings</a>
        <a href="#" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-white">Employee Login</a>
        <a href="#" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-white">Link 4</a>
      </div>

  <!-- Navbar on small screens -->
  <div id="navDemo" class="w3-bar-block w3-white w3-hide w3-hide-large w3-hide-medium w3-large">
    <a href="#" class="w3-bar-item w3-button w3-padding-large">See Compliants</a>
    <a href="#" class="w3-bar-item w3-button w3-padding-large">See Meetings</a>
    <a href="#" class="w3-bar-item w3-button w3-padding-large">Employee Login</a>
    <a href="#" class="w3-bar-item w3-button w3-padding-large">Link 4</a>
  </div>
</div>

<!-- Header -->
<header class="bgimg w3-display-container w3-grayscale-min" style="padding:128px 16px">
  <h1 class="w3-margin w3-jumbo">Complaints Page</h1>
  <p class="w3-xlarge">Employees only</p>

  
</header>

<!-- First Grid -->
<div class="w3-row-padding w3-padding-64 w3-container">
  <div class="w3-content">
    <div class="w3-twothird">
      <h1>Lodged complaints</h1>
      <table>
        <thead>
            <tr><th>ID</th><th>Desc</th><th>Priority</th><th>MeetingID</th></tr>
        </thead>
        <tbody id="complaintTableBody">

        </tbody>
    </table>
    <table>
        <br />
        <br />
        <h3>Pick complaint to update</h3>
        
        <tbody id="updateComplaintTableBody">

        </tbody>
        
    </table>
    <button id="submit">submission</button>


  </div>
</div>

<!-- Second Grid -->
<div class="w3-row-padding w3-light-grey w3-padding-64 w3-container">
  <div class="w3-content">
    
  </div>
</div>

<div class="w3-container w3-black w3-center w3-opacity w3-padding-64">
    <h1 class="w3-margin w3-xlarge">Quote of the day: live life</h1>
</div>

<!-- Footer -->
<footer class="w3-container w3-padding-64 w3-center w3-opacity">  
  <div class="w3-xlarge w3-padding-32">
    <i class="fa fa-facebook-official w3-hover-opacity"></i>
    <i class="fa fa-instagram w3-hover-opacity"></i>
    <i class="fa fa-snapchat w3-hover-opacity"></i>
    <i class="fa fa-pinterest-p w3-hover-opacity"></i>
    <i class="fa fa-twitter w3-hover-opacity"></i>
    <i class="fa fa-linkedin w3-hover-opacity"></i>
 </div>
 <p>Powered by <a href="https://www.w3schools.com/w3css/default.asp" target="_blank">w3.css</a></p>
</footer>

<script>
// Used to toggle the menu on small screens when clicking on the menu button
function myFunction() {
  var x = document.getElementById("navDemo");
  if (x.className.indexOf("w3-show") == -1) {
    x.className += " w3-show";
  } else { 
    x.className = x.className.replace(" w3-show", "");
  }
}
   /*
                {
        "complaintID": 16,
        "complaintDesc": "i exist  and i dont like it",
        "priority": "PENDING",
        "meetingID": 4
    }
        */

        const complaintTableBody = document.getElementById("complaintTableBody");
    const updateComplaintTableBody = document.getElementById("updateComplaintTableBody");
    // fetching the data is a seperate function from rendering the data

    function listenForBtn()
    {
        //var clickMeButton = document.createElement('button');
        //clickMeButton.id = 'submit';
        //clickMeButton.innerHTML = 'Click Me';
        
        //document.body.appendChild(clickMeButton);
        //user will now modify/ update the complaint by its priority, and meeting id

        const submitBtn = document.getElementById("submit");

        submitBtn.addEventListener("click", async event => {
            const inputID = document.getElementById("inputID");
            const inputPriority = document.getElementById("inputPriority");
            const inputMeetingId = document.getElementById("inputMeetingId");
        
            console.log("submit button hit");
            event.preventDefault();// will catch the submit event from the form and prevent sending an HTTP request immediately and reloading the page


            const complaintId = inputID.options[inputID.selectedIndex].value;
            console.log(complaintId);
            const complaintPriority = inputPriority.options[inputPriority.selectedIndex].value;
            const complaintMeetingID = inputMeetingId.options[inputMeetingId.selectedIndex].value;
            console.log(complaintMeetingID);

            



            

            /*
                {"ComplaintID":1,"complaintDesc":"Darth vader Keeps breathing down my neck","priority":"PENDING","meetingID":-1}
            */

            const complaint = {"ComplaintID":complaintId,"complaintDesc":"if you see me, then something has gone wrong","priority":complaintPriority,"meetingID":complaintMeetingID};

            // second argument is options for the fetch
            const response = await fetch(`http://localhost:8080/complaint/${complaintId}/${complaintMeetingID}`,{
                method:"PUT", 
                body: JSON.stringify(complaint),
                headers:{
                    "Content-Type":"application/json"
                }
            });

            if(response.status === 201){
                alert(`The complaint ${complaint} has been sent`);

            }else{
                alert("You have failed me for the last time");
            }

        });
    }



    function renderUpdateTable(array, nameForId)
    {
        // assume we pass in an array
        var myParent = document.body;
        const complaintRow = document.createElement("tr");
        



            //Create and append select list
            var selectList = document.createElement("select");
            selectList.id = nameForId;
            myParent.appendChild(selectList);

            //Create and append the options
            for (var i = 0; i < array.length; i++) {
                var option = document.createElement("option");
                option.value = array[i];
                option.text = array[i];
                selectList.appendChild(option);
            }
            //complaintRow.appendChild(selectList);
            updateComplaintTableBody.appendChild(selectList);
            



    }

    async function getMeetings()
    {
        const httpResponse = await fetch("http://localhost:8080/meeting");
        const meetings = await httpResponse.json();
        return meetings;

    }


    async function renderMeetTable() //renders the dropdown of meeting IDs
    {
        const testMeetings = await getMeetings(); // make sure you await any async functions you call
        var meetingIDArray = [];

        console.log(testMeetings);
        for (const meet of testMeetings)
        {

            meetingIDArray.push(meet.id);
        }
        //console.log(meetingIDArray);

        renderUpdateTable(meetingIDArray, "inputMeetingId");


    }

    async function getComplaints()
    {
        const httpResponse = await fetch("http://localhost:8080/complaint");
        const complaints = await httpResponse.json();
        return complaints;

    }

    async function renderComplaintTable()
    {
        const testComplaints = await getComplaints(); // make sure you await any async functions you call
        
        //Create array of options to be added
        var array = [];
        var priorityArray = ['HIGH', 'LOW', 'IGNORED', 'PENDING', 'ADDRESSED'];
        

        for (const complaint of testComplaints)
        {

            const complaintRow = document.createElement("tr");
            

            const complaintIdData = document.createElement("td");
            complaintIdData.innerText = complaint.complaintID;
            array.push(complaint.complaintID);

            

            const complaintDescData = document.createElement("td");
            complaintDescData.innerText = complaint.complaintDesc;

            const complaintPriorityData = document.createElement("td");
            complaintPriorityData.innerText = complaint.priority;
            //priorityArray.push(complaint.priority);

            const complaintMeetingIDData = document.createElement("td");
            complaintMeetingIDData.innerText = complaint.meetingID;
            //meetingIDArray.push(complaint.meetingID);

            

            complaintRow.appendChild(complaintIdData);
            complaintRow.appendChild(complaintDescData);
            complaintRow.appendChild(complaintPriorityData);
            complaintRow.appendChild(complaintMeetingIDData);


            complaintTableBody.appendChild(complaintRow);
            //building id drop down for update

            const complaintIDRows = document.createElement("select");

            //const updateComplaintIdData = document.createElement("option");
            //updateComplaintIdData.innerText = complaint.complaintID;
            
            //complaintIDRows.appendChild(updateComplaintIdData);
            //updateComplaintTableBody.appendChild(complaintIDRows);
            
            
        }
        const complaintDescData = document.createElement("b");
        complaintDescData.innerText = "ID";
        updateComplaintTableBody.appendChild(complaintDescData);
        renderUpdateTable(array, "inputID");

        updateComplaintTableBody.appendChild(document.createElement("br"));
        const complaintPriortiyData = document.createElement("b");
        complaintPriortiyData.innerText = "Priority";
        updateComplaintTableBody.appendChild(complaintPriortiyData);

        renderUpdateTable(priorityArray, "inputPriority");
        updateComplaintTableBody.appendChild(document.createElement("br"));
        const complaintMeetingIDData = document.createElement("b");
        complaintMeetingIDData.innerText = "Meeting ID";
        updateComplaintTableBody.appendChild(complaintMeetingIDData);
        renderMeetTable();

        

        listenForBtn();

        
        
        






    }



    renderComplaintTable();





    

    






    

    


</script>

</body>
</html>